# Field2004
field development data visualization program developed in 2004 


## Общая информация.

  Приложение Field создаётся для предварительной обработки и загрузки данных в программу гидродинамических 
  расчётов Proect а также для последующей визуализации и представления результатов работы в виде твёрдых
  копий. В существующей реализации Field требует для своей работы базу данных с геологической информацией
  в формате MDB (Microsoft Jet Database Engine) и файл с распределениями фильтрационно-ёмкостных свойств
  в формате HDF (Hierarchical Data Format). После загрузки данных пользователю доступны три окна, которые
  согласно их функциональному назначению называются обзорное окно (слева), навигационная панель (снизу) и
  рабочая область. Ввиду того, что программа Proect ориентируется на обработку больших нефтегазопромысловых 
  объектов, характерные размеры сеток, хранящихся в файле HDF достигают нескольких лесятков миллионов ячеек, 
  что затрудняет визуализацию объекта как единого целого кроме как в простейшем виде. Поэтому было принято 
  дезайнерское решение создать два отдельных окна -- обзорное окно для схематического отображения объекта и
  рабочая область для детальной работы с участком обекта. Навигационная панель предоставляет пользователю 
  возможность загрузки промысловой информации из MDB файла за определённый период, переключаться межде 
  отображением карт различных ФЕС (как статических так и динамических), выбрать для отображения определённый
  слой гидродинамической сетки, а также присутствуют два списка для фокусировки рабочей области на какой-
  либо добывающей или нагнетательной скважине. Такая среда для работы позволяет инженеру уловить общие
  характеристики модели резервуара. Кроме этого, доступен ряд вспомогательных средств: отображение всех
  имеющихся свойств в числовом виде для отдельной колонки ячеек, построение карты насыщенности выделенного
  слоя трёхмерного резервуара с трёхфазной диаграммой, подсчет запасов углеводородов в целом по месторождению
  или между двумя поверхностями (например, между кровлей и подошвой заданного пласта), построение вертикальных 
  разрезов для отображения конкретного свойства резервуара, построение вертикальноых разрезов для отображения
  характера насыщения резервуара, построение карты с произвольными интегральными характеристиками резервуара
  или отдельной его части. Для отображения данных в виде твёрдой копии в настоящее время используется язык 
  описания документов Postscript, что позволяет добиться максимально возможного качества изображения при 
  печати на принтере.


## Структура геолого-промысловой базы данных.

  Структура геолого-промысловой базы данных заимствована у продукта Finder фирмы Slumberger с небольшими 
  изменениями. В настоящее время эта БД служит также и единственным источником данных для импорта в Field.
  При импорте делается попытка исправить отдельные ошибки, которые присутствуют в БД Finder. База данных 
  содержит 11 таблиц:
    
    o head -- таблица сопоставляет индекс ствола скважины её имени, кусту, а также определяет координаты 
      устья скважины

    o traj -- таблица сопоставляет индексу ствола скважины описание его траектории (инклинометрия)

    o perf -- таблица сопоставляет индексу ствола скважины интервалы перфорации и пласт, который вскрывает
      данный интервал

    o prod -- таблица с частью истории разработки месторождения по добывающим скважинам

    o pump -- таблица с частью истории разработки месторождения по нагнетательным скважинам

    o layer -- таблица с отметками отдельных геологических формаций вдоль ствола скважины

    o seam -- таблица с измерениями различных фильтрационно-ёмкостных свойств вдоль ствола скважины

    o surf -- отметки кровли и подошвы различных пластов, согласованные с моделью, записанной в HDF-файле

    o press -- информация по давлениям, обводнённости, скорости отбора и т.д.

    o text -- таблица с текстовой информацией

    o dict -- вспомогательная таблица

## Структура файла с распределением ФЕС

  Файл с распределением фильтрационно-ёмкостных свойств имеет формат HDF (hierarchical data format 
  version 1.4.4, разработка национального центра суперкомпьютерных технологий США), который в настоящее
  время является одним из стандартных форматов для представления научной информации. Автор старался
  определить структуру файла как можно более простой, чтобы сократить время отклика программы на 
  действия пользователя. В корневом каталоге хранятся трёхмерные свойства резервуара. Программа не различает
  семантику с которой инженер использует то или иное свойство. Каждое свойство упорядочено таким же образом
  с которым оно хранится в памяти, т.е. сначала изменяется индекс, соответствующий координате x, затем
  индекс по координате y, затем индекс по координате z. Единственное различие имеет формат для 
  геометрии резервуара. Геометрия резервуара задаётся массивом реперных поверхностей с равномерным 
  распределением слоёв между ними. В плоскости xy сетка представлена как однородная прямоугольная.
  Вся информация, распололоженная вне корневого каталога является вспомогательной и не будет поддерживаться
  с развитием программы. Кроме того каждому свойству приписан ряд атрибутов, задающих наименование, диапозон 
  изменения, единицы измерения и тип палитры.

## Рабочая область

  Рабочая область является основным элементом, с помощью котокого программа взаимодействует с
  пользователем. В ней отображена карта участка месторождения, с которой работает инженер в каждый
  конкретный момент времени. Имеется три режима отображения карты: контурная карта, билинейная интерполяция
  свойств и отображение ячейки в соответствии таблицей, сопоставляющей данные и цвет (color-to-data 
  mapping). Такая таблица может быть логарифмической или арифметической. Имеется возможность её редактирования 
  или загрузки из внешнего файла. Файл с палитрой имеет следующий формат:

    Z0 Rmin Gmin Bmin Z1 Rmax Gmax Bmax
    Z2 Rmin Gmin Bmin Z3 Rmax Gmax Bmax
    ...
    Zn-2 Rmin Gmin Bmin Zn-1 Rmax Gmax Bmax

  что позволяет задать как постоянный цвет для каждого уровня, так и плавный переход цвета между отдельными 
  уровнями. Диалог для редактирования палитры вызывается при щелчке правой кнопки мыши над окном отображения 
  данных в цвет около правой границы рабочей области. Чтобы освободить больше места для рабочей области
  окно палитры можно погасить с помощью контекстно-зависимого меню. Таким же образом можно погасить
  линии гидродинамической сетки и масштабный индикатор в левом нижнем кглу. Используя элемент управления
  календарь на панели управления, инженер может выбрать дату, на которую будет показана картина разработки 
  месторождения. При этом изменится список скважин, работающих в нагнетательном или добывающем режиме.
  Чтобы увидеть информацию по дебитам на выбранный момент времени, необходимо согласовать списки скважин
  с рабочей областью путём двойного щелчка над значком интересующей скважины. В правой части панели управления
  имеется движок, с помощью которого можно выбрать определённый слой сетки. Если в исходных данных присутствуют
  массивы нефтенасыщенности (soil) и газонасыщенности (sgas), имеется возможность переключиться в режим
  отображения насыщенности согласно тройной диаграмме (пункт CumulativeS меню View).

## Построение разрезов

  Диалог для построения разрезов вызывается путём выбора пункта Cross Section из меню View. Пользователь
  задаёт конорольные точки на карте по двойному шелчку левой кнопки мыши. Точка считается определённой
  в стволе скважины, если она попадает в круг радиуса 5м от истинного положения скважины. При этом в окне диалога 
  Cross Section высвечивается имя соответствующей скважины. Ранее определённые точки можно перетащить мышью
  в новое положение, при этом соответствующим образом будет обновлён рабочий диалог. Удерживая клавишу Ctrl
  таким же образом можно продублировать какую-либо контрольную точку на новом месте. В окне диалога имеются 
  кнопки для изменения порядка расположения контрольных точек и их удаления. Из меню File можно загрузить 
  ранее сохранённый разрез или сохранить текущий. Формат файла для разреза -- последовательность координат
  контрольных точек. По нажатию кнопки Plot запускается процедура загрузки данных из базы и автоматически
  генерируется код программы на языке Postscript для графического представления разреза в векторном виде.
  Путём выбора пункта меню Options в окне диалога Cross Section можно задать такие характеристики печатаемой
  диаграммы как размеры полей, число страниц, характеристики сетки, формат бумаги и др. Тип разреза зависит 
  от того, активен ли режим CumulativeS. Если режим включён, то строится разрез, на котором показаны зоны
  коллектор/неколлектор а также характер насыщения коллектора флюидами. Если режим CumulativeS отключен,
  строится разрез текущего куба свойств. При этом, если доступна соответствующая информация вдоль ствола
  скважины, что позволяет инженеру оценить, наскоько точно геологическая модель соответствует экпериментальным
  данным. 

## Подсчёт запасов и других интегральных характеристик

  Диалог для подсчёта запасов вызывается командой Resources из меню View. По умолчанию подсчитываются запасы
  нефти и, если в модели присутствует газовая фаза, газа в целом по модели. В окне диалога присутствуют
  поля редактирования для задания плотности нефти в поверхностных условиях, пересчётного коэффициента,
  а также термического и барического коэффициентов для газа. При нажатии кнопки Edit всплывает диалог
  для задания новых или редактирования уже существующих объектов, по которым ведётся подсчёт запасов 
  углеводородов. Геологические обекты (пласты) могут быть определены поверхностями кровли и подошвы,
  которые выступают как пределы интегрирования при подсчёте запасов. Существующие свойства отображаются 
  в списке с левой стороны, при щелчке на элементе этого списка, его характеристики загружаются в поля
  редактирования с правой стороны. Обновляется список при нажатии кнопки Update. Выделенный элемент списка
  кожно удалть при нажатии кнопки Remove. Когда всплывает окно диалога Resources, программа переключается 
  в режим отображения двумерных полей. В обзорном окне и в рабочей области отображаются карты, 
  соответствующие удельным запасам свойства, находящегося в выделенной ячейке окна диалога. Переключение 
  между различными свойствами происходит по щелчку мыши над соответствующими ячейками. Программа 
  возвращается в обычный режим работя при нажатии кнопки Done. 

  В ходе работы с программой встала необходимость обращаться к другим интегральным характеристикам 
  месторождения, таким как, например, карты нефтенасыщенных толщин. Порядок работы с такими характеристиками
  очень похож на работу с удельными запасами, но, к сожалению, не предусмотрен в схеме для подсчёта запасов.
  Поэтому был разработан более универсальный инструмент, названный Integral Properties. Окно диалога
  Integral Properties вызывается командой Integral Prop из меню View. Как и окно диалога Resources,
  окно для интегральных свойств месторождения имеет слева список свойств, а справа -- поля для редактирования
  характеристик, определяющие выделенное в списке свойство. Эти характеристики разделяются на три группы: 
  Integral dataset, Geological formation и Areal constraint. Integral dataset название интегральной 
  характеристики, арифметическое выражение для подынтегральной функции и необязательный комментарий,
  описывающий набор данных. Geological formation, подобно диалогу Resources, задаёт поверхности,
  ограничивающие область интегрирования сверху и  снизу. Areal constraint задаёт контур, внутри которого 
  производится интегрирование. Если Geological formation или Areal constraint не заданы, интегрирование 
  происходит по всему месторождению. Для каждой из групп свойств ведётся свой список, что позволяет сильно 
  сократить время расчёта, если требуется определить множество интегральных характеристик по одному и тому
  же объекту разработки. Напимер, если требуется подсчитаь запасы нефти и газа, содержащиеся в пласте АС10,
  на территории ДНС12, после расчёта по нефти пользователь задаёт новую информацию только для группы Integral
  dataset, при этом расчёт индикаторной карты второй раз производиться не будет. Результаты расчётов можно
  записать в файл с помощью команды Save из меню File. Во время следующего сеанса работы, ранее посчитанные 
  интегральные характеристики можно загрузить с помощью команды Open из меню File. Контур, ограничивающий
  область интегрирования в плоскости XY, загружается из файла в формате *.bln программы Surfer. Аналогично,
  поверхности, ограничивающие геологический объект, задаются в формате *.grd программы Surfer, поддерживаются
  файлы с сигнатурами DSAA, DSBB, DSRB. Нажатие кнопки Digitize предоставляет возможность визуального
  редактирования контура с последующей записью в файл.
